---
import type { CableSpec } from '../utils/cableData';
import { getMaxDataRate, getMaxPower } from '../utils/cableData';

export interface Props {
  cable: CableSpec;
  category: string;
}

const { cable, category } = Astro.props;

// Get primary protocol info for display
const primaryProtocol = Object.keys(cable.protocols)[0];
const primaryProtoInfo = cable.protocols[primaryProtocol];

// Format data rate for display
const maxRate = getMaxDataRate(cable);
function formatDataRate(mbps: number): string {
  if (mbps >= 1000) {
    return `${mbps / 1000} Gbps`;
  }
  return `${mbps} Mbps`;
}

const maxPower = getMaxPower(cable);

// Determine if this is a legacy connector (based on confusion points or notes)
const isLegacy = cable.notes?.toLowerCase().includes('obsolete') ||
                 cable.notes?.toLowerCase().includes('legacy') ||
                 cable.notes?.toLowerCase().includes('phased out') ||
                 cable.confusion_points.some(p => p.toLowerCase().includes('obsolete') || p.toLowerCase().includes('deprecated'));
---

<div class="group relative bg-card border border-border rounded-2xl transition-all hover:border-primary/30 hover:shadow-lg hover:shadow-primary/5">
  <a href={`/${category}/${cable.type.toLowerCase().replace(/[^a-z0-9]/g, '-')}`} class="block p-6" aria-label={`View detailed specifications for ${cable.type}`}>
    <!-- Badges -->
    <div class="absolute top-4 right-4 flex gap-2">
      {isLegacy && (
        <span class="badge badge-muted">Legacy</span>
      )}
    </div>
    <div class="absolute top-4 left-4 flex gap-2">
      {cable.connector.reversible && (
        <span class="badge badge-reversible">Reversible</span>
      )}
    </div>

    <!-- Header -->
    <div class="mt-6 mb-4">
      <h3 class="text-xl font-semibold text-foreground mb-1">{cable.type}</h3>
      <p class="text-sm">{cable.full_name}</p>
    </div>

    <!-- Specs Grid -->
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div>
        <p class="text-xs mb-1">Max Speed</p>
        <p class="text-foreground font-medium">
          {formatDataRate(maxRate)}
        </p>
      </div>
      {maxPower && (
        <div>
          <p class="text-xs mb-1">Max Power</p>
          <p class="text-foreground font-medium">
            {maxPower}W
          </p>
        </div>
      )}
    </div>

    <!-- Connector Info -->
    <div class="mb-4">
      <p class="text-xs mb-1">Connector</p>
      <p class="text-foreground text-sm">
        {cable.connector.pins} pins, {cable.connector.width}×{cable.connector.height}mm
      </p>
    </div>

    <!-- Common Uses -->
    <div class="mb-4">
      <p class="text-xs mb-2">Common Uses</p>
      <div class="flex flex-wrap gap-1">
        {cable.common_devices.slice(0, 3).map((device: string) => (
          <span class="tag text-xs">{device}</span>
        ))}
        {cable.common_devices.length > 3 && (
          <span class="tag-muted text-xs">+{cable.common_devices.length - 3} more</span>
        )}
      </div>
    </div>

    <!-- Warning -->
    {cable.confusion_points.length > 0 && (
      <div class="mb-4 p-3 bg-warning/10 border border-warning/20 rounded-lg">
        <p class="text-warning-foreground text-sm">
          {cable.confusion_points[0]}
        </p>
      </div>
    )}

    <!-- Footer -->
    <div class="flex items-center gap-1 text-sm">
      <span class="group-hover:underline">Learn more</span>
      <span class="transition-transform group-hover:translate-x-0.5">→</span>
    </div>
  </a>
</div>
